<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/beginners-mindset/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/beginners-mindset/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/beginners-mindset/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/beginners-mindset/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Pastebin System Design | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Pastebin System Design" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Beginner’s Mindset by Nandan" /> <meta property="og:description" content="Beginner’s Mindset by Nandan" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Pastebin System Design" /> <script type="application/ld+json"> {"headline":"Pastebin System Design","description":"Beginner’s Mindset by Nandan","@type":"WebPage","url":"/beginners-mindset/articles/pastebin-system-design/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/beginners-mindset/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/beginners-mindset/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/beginners-mindset/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/beginners-mindset/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="/beginners-mindset/papers/" class="nav-list-link">Papers</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/NandanSatheesh/beginners-mindset" class="site-button" > Beginner's Mindset on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/beginners-mindset/articles/">Articles</a></li> <li class="breadcrumb-nav-list-item"><span>Pastebin System Design</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="pastebin-system-design"> <a href="#pastebin-system-design" class="anchor-heading" aria-labelledby="pastebin-system-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pastebin System Design </h1> <p>With Pastebin you can paste the text data in one place and share it with other users across the world with a unique URL.</p> <h2 id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h2> <h3 id="non-functional-requirements"> <a href="#non-functional-requirements" class="anchor-heading" aria-labelledby="non-functional-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non Functional Requirements </h3> <ul> <li>User should be able to share data - text only with a unique URL.</li> <li>The link should have capabilities like read once only (burn after read) or expiry after first read to expiry after the time specified.</li> <li>Support syntax highlighting.</li> </ul> <h3 id="functional-requirements"> <a href="#functional-requirements" class="anchor-heading" aria-labelledby="functional-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Functional Requirements </h3> <ul> <li>The uploaded data should not be lost.</li> <li>Links should be unique and random.</li> <li>Highly Available.</li> </ul> <h3 id="future-scope"> <a href="#future-scope" class="anchor-heading" aria-labelledby="future-scope"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Future Scope </h3> <ul> <li>Analytics</li> </ul> <h2 id="capacity-estimations"> <a href="#capacity-estimations" class="anchor-heading" aria-labelledby="capacity-estimations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Capacity Estimations </h2> <ul> <li>The above system is being designed keeping only text data in mind with size of 1MB. In case of huge amounts of data, Object Stores on Cloud like S3 can be considered.</li> <li>The System will be a read-heavy system. Assuming 10 reads for 1 write. 10 : 1 Ratio.</li> <li>Assumptions: Expected Monthly Active users - 10M and Max Paste Size - 1MB</li> </ul> <h3 id="traffic-figures-estimation"> <a href="#traffic-figures-estimation" class="anchor-heading" aria-labelledby="traffic-figures-estimation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Traffic Figures Estimation </h3> <p>Traffic Figures Estimation - with Read : Write Ratio of 10 : 1<br /> Expected MAU = 10M<br /> Expected Requests = 100M<br /> Total Read Requests a month = 100M Reads/Month<br /> Total ReadRequests per sec = 100M/(30 * 24 * 2600) = 38 read-requests/second<br /> Similarly for writes = 3.8 write-requests/second</p> <h3 id="storage-figures-estimation"> <a href="#storage-figures-estimation" class="anchor-heading" aria-labelledby="storage-figures-estimation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Storage Figures Estimation </h3> <p>Expecting at-least 1 paste by every user Total Paste = 10M Users X 1MB = 10TB/month Around ~ 120 TB/year</p> <p>Cache Estimation = 20% of read-traffic = 2TB/month</p> <h2 id="apis"> <a href="#apis" class="anchor-heading" aria-labelledby="apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> APIs </h2> <p>POST /v1/paste-bin/ Adds paste to the paste-bin</p> <p>GET /v1/paste-bin/{paste-id} Gets the paste from the paste-bin based on the paste-id sent</p> <p>GET /v1/paste-bin/recent-items Gets the recent public pastes</p> <h2 id="database-design"> <a href="#database-design" class="anchor-heading" aria-labelledby="database-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database Design </h2> <p>User Details Table</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id
userId - PK
userName
password
createdAt
updatedAt
socialAuthDetails
</code></pre></div></div> <p>User Pastes Table</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id
pasteId
pasteData
syntaxHighlight
expiryDetails 
accessTimes
pasteName
pasteExposure 
size
url
userId
isActive
createdAt
updatedAt
</code></pre></div></div> <p>syntaxHighlight - Highlight can be C, C++, Java etc. which will be handled on the front end side mostly. An enum can be stored here.<br /> expiryDetails - This can be an Enum too. There can be cases like burn after read, after 1 min to several days.<br /> pasteExposure - Public or Private Pastes. url - This can be the unique short URL generated from KeyGen Service.</p> <p>As the paste data is stored in the database in the current design, a histroy table can also be used to know what were the items in the last save made. This table can be treated as something simialar to access logs. This will be insert only table for reference only.</p> <p>User Paste History</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id
pasteId
userId
pasteData
syntaxHighlight
createdAt
size
</code></pre></div></div> <h2 id="high-level-design"> <a href="#high-level-design" class="anchor-heading" aria-labelledby="high-level-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> High Level Design </h2> <p>DB for User Details can be any RDBMS (MySQL) DB for User Paste Details can be any NoSQL (MongoDB) If we want to store the object data, cloud object stores like S3 can also be used. KeyGen Server - A seperate entity for creation of unique keys (6-8 character long) for providing unique keys as and when required. Async Cleanup Service - Service to mark paste details isActive as <code class="language-plaintext highlighter-rouge">false</code> when the expiryDetails conditions are met. (This can also be done with a Scheduler Service for deletion when the time is specific like - 1 day, etc.).</p> <p>Flow when a paste is created and accessed</p> <ol> <li>Requests hits the application</li> <li>Generate a unique key from KeyGen Service.</li> <li>Store the data in the DB/ Cloud Object Store and return the unique link.</li> </ol> <p>Flow when a paste has to be accessed</p> <ol> <li>Request hits the application</li> <li>Find the unique URL from the userPasteDetails table</li> <li>Update the accessTimes and return it back. If the expiryDetails has burn after read - set isActive as false and return the paste details with meta data - syntax highlighting, etc.</li> <li>If the data from DB already has inActive as false, then send nothing found.</li> </ol> <p>The Async Cleanup can be run everyday or the Scheduler can be made to run at a specific point of time.</p> <h3 id="caching"> <a href="#caching" class="anchor-heading" aria-labelledby="caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caching </h3> <p>Caching - 20% of Read Traffic. Redis can be used here. Eviction Policy - LRU</p> <h3 id="load-balancing"> <a href="#load-balancing" class="anchor-heading" aria-labelledby="load-balancing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Load Balancing </h3> <p>LB Between Client and Server or Server and DBs or both.<br /> Approaches - Round Robin, Least Connections, Network Hashes.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
